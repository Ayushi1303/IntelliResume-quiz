{% extends "base.html" %}
{% block title %}IntelliResume — Upload to Generate Quiz{% endblock %}
{% block content %}
    <section class="hero">
        <h2>Turn your resume into a personalized quiz</h2>
        <p>Upload a PDF and get instant practice questions from your own experience.</p>
        <div class="features">
            <span class="chip">Private by default</span>
            <span class="chip">Fast analysis</span>
            <span class="chip">AI-powered</span>
        </div>
    </section>

    <div class="grid">
        <div class="card">
            <div class="card-header">
                <h3>Upload your resume</h3>
                <p>Supported format: PDF. Your file stays on this device.</p>
            </div>
            <div class="card-body">
                <form action="/" method="post" enctype="multipart/form-data" id="uploadForm">
                    <label class="uploader" id="dropArea" for="resumeInput" tabindex="0" aria-label="Upload resume. Drag and drop or press Enter to browse.">
                        <div class="icon" aria-hidden="true">
                            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 16V4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                <path d="M7 9l5-5 5 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M20 16v2a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                        </div>
                        <h4>Drag & Drop your resume</h4>
                        <p>or click to browse files from your device</p>
                        <input class="hidden-input" id="resumeInput" type="file" name="resume" accept=".pdf" required>
                    </label>
                    <div class="controls">
                        <div class="left">
                            <button class="btn" id="startBtn" type="submit">Start Quiz</button>
                            <button class="btn secondary" type="button" id="clearBtn">Clear</button>
                        </div>
                        <span id="fileInfo" class="meta" aria-live="polite">No file selected</span>
                    </div>
                </form>
            </div>
        </div>

        <aside class="side">
            <h4>Tips for best results</h4>
            <ul>
                <li>Use your latest resume version.</li>
                <li>Prefer well-structured PDFs or clean TXT export.</li>
                <li>Include key projects, skills, and achievements.</li>
            </ul>
        </aside>
    </div>
{% endblock %}
<script>
        (function() {
            const input = document.getElementById('resumeInput');
            const drop = document.getElementById('dropArea');
            const info = document.getElementById('fileInfo');
            const form = document.getElementById('uploadForm');
            const clearBtn = document.getElementById('clearBtn');
            const startBtn = document.getElementById('startBtn');

            const allowed = ['application/pdf'];
            const maxSize = 10 * 1024 * 1024; // 10MB

            function updateInfo(file) {
                if (!file) { info.textContent = 'No file selected'; return; }
                info.textContent = `${file.name} • ${(file.size/1024/1024).toFixed(2)} MB`;
            }

            function validate(file) {
                if (!file) return false;
                if (!allowed.includes(file.type) && !/\.(pdf)$/i.test(file.name)) {
                    alert('Please upload a PDF file.');
                    return false;
                }
                if (file.size > maxSize) {
                    alert('File is too large. Max size is 10MB.');
                    return false;
                }
                return true;
            }

            drop.addEventListener('dragover', (e) => {
                e.preventDefault();
                drop.classList.add('dragover');
            });
            drop.addEventListener('dragleave', () => drop.classList.remove('dragover'));
            drop.addEventListener('drop', (e) => {
                e.preventDefault();
                drop.classList.remove('dragover');
                const file = e.dataTransfer.files[0];
                if (validate(file)) {
                    input.files = e.dataTransfer.files;
                    updateInfo(file);
                }
            });

            // Keyboard accessibility
            drop.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    input.click();
                }
            });

            input.addEventListener('change', () => updateInfo(input.files[0]));

            clearBtn.addEventListener('click', () => {
                input.value = '';
                updateInfo(null);
                input.focus();
            });

            form.addEventListener('submit', (e) => {
                const file = input.files[0];
                if (!validate(file)) { e.preventDefault(); return; }
                startBtn.disabled = true;
                startBtn.textContent = 'Processing...';
            });

            // Prevent accidental browser open on window drop
            window.addEventListener('dragover', (e) => e.preventDefault());
            window.addEventListener('drop', (e) => e.preventDefault());
        })();
    </script>
</body>
</html>